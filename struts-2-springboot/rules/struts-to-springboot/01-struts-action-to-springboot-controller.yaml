# Rules for migrating Struts Action classes to Spring MVC Controllers

- category: mandatory
  customVariables: []
  description: Replace Struts Action with Spring @Controller
  effort: 5
  labels:
    - konveyor.io/source=struts
    - konveyor.io/target=springboot
  links:
    - title: Spring MVC Controllers
      url: https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-controller
    - title: Spring @Controller Annotation
      url: https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/stereotype/Controller.html
  message: |
    Struts `Action` classes must be converted to Spring MVC `@Controller` classes.
    
    **Before (Struts 1.x Action):**
    ```java
    import org.apache.struts.action.Action;
    import org.apache.struts.action.ActionForm;
    import org.apache.struts.action.ActionForward;
    import org.apache.struts.action.ActionMapping;
    
    public class ListAccountsAction extends Action {
        @Override
        public ActionForward execute(ActionMapping mapping, ActionForm form,
                HttpServletRequest request, HttpServletResponse response) throws Exception {
            List<Account> accounts = accountDAO.findAll();
            request.setAttribute("accounts", accounts);
            return mapping.findForward("success");
        }
    }
    ```
    
    **After (Spring MVC Controller):**
    ```java
    import org.springframework.stereotype.Controller;
    import org.springframework.ui.Model;
    import org.springframework.web.bind.annotation.GetMapping;
    
    @Controller
    public class AccountController {
        
        private final AccountService accountService;
        
        public AccountController(AccountService accountService) {
            this.accountService = accountService;
        }
        
        @GetMapping("/accounts")
        public String listAccounts(Model model) {
            List<Account> accounts = accountService.findAll();
            model.addAttribute("accounts", accounts);
            return "list"; // Returns view name
        }
    }
    ```
    
    Key changes:
    - Replace `Action` base class with `@Controller` annotation
    - Replace `execute()` method with handler methods annotated with `@GetMapping`, `@PostMapping`, etc.
    - Replace `ActionMapping.findForward("name")` with returning the view name as a String
    - Replace `request.setAttribute()` with `Model.addAttribute()`
    - Use constructor injection for dependencies (replaces manual DAO instantiation)
  ruleID: struts-action-to-springboot-00001
  when:
    java.referenced:
      location: INHERITANCE
      pattern: org.apache.struts.action.Action

- category: mandatory
  customVariables: []
  description: Replace ActionForward with Spring view name return
  effort: 2
  labels:
    - konveyor.io/source=struts
    - konveyor.io/target=springboot
  links:
    - title: Spring MVC View Resolution
      url: https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-viewresolver
  message: |
    Struts `ActionForward` is replaced by returning view names or `ModelAndView` in Spring MVC.
    
    **Before (Struts):**
    ```java
    public ActionForward execute(ActionMapping mapping, ...) {
        // Success case
        return mapping.findForward("success");
        
        // Error case
        return mapping.findForward("error");
        
        // Redirect
        return new ActionForward("/accounts.do", true);
    }
    ```
    
    **After (Spring MVC):**
    ```java
    @GetMapping("/accounts")
    public String listAccounts(Model model) {
        // Success - returns view name
        return "accounts/list";
    }
    
    @GetMapping("/error")
    public String handleError() {
        return "error";
    }
    
    @PostMapping("/accounts")
    public String createAccount(@ModelAttribute Account account) {
        accountService.save(account);
        // Redirect after POST (PRG pattern)
        return "redirect:/accounts";
    }
    ```
    
    Spring MVC view resolution:
    - Return `"viewName"` for forward to view
    - Return `"redirect:/path"` for redirect
    - Return `"forward:/path"` for forward to another handler
  ruleID: struts-action-to-springboot-00002
  when:
    java.referenced:
      location: IMPORT
      pattern: org.apache.struts.action.ActionForward

- category: mandatory
  customVariables: []
  description: Replace ActionMapping with Spring @RequestMapping
  effort: 2
  labels:
    - konveyor.io/source=struts
    - konveyor.io/target=springboot
  links:
    - title: Spring @RequestMapping
      url: https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-ann-requestmapping
  message: |
    Struts `ActionMapping` configuration in struts-config.xml is replaced by Spring `@RequestMapping` annotations.
    
    **Before (struts-config.xml):**
    ```xml
    <action path="/listAccounts"
            type="com.redhat.bank.action.ListAccountsAction"
            scope="request">
        <forward name="success" path="/list.jsp"/>
        <forward name="error" path="/error.jsp"/>
    </action>
    ```
    
    **After (Spring @Controller):**
    ```java
    @Controller
    @RequestMapping("/accounts")
    public class AccountController {
        
        @GetMapping
        public String listAccounts(Model model) {
            // ...
            return "list";
        }
        
        @GetMapping("/{id}")
        public String viewAccount(@PathVariable Long id, Model model) {
            // ...
            return "view";
        }
        
        @PostMapping
        public String saveAccount(@ModelAttribute AccountDTO account) {
            // ...
            return "redirect:/accounts";
        }
    }
    ```
    
    Mapping annotations:
    - `@GetMapping` - HTTP GET requests
    - `@PostMapping` - HTTP POST requests
    - `@PutMapping` - HTTP PUT requests
    - `@DeleteMapping` - HTTP DELETE requests
    - `@RequestMapping` - Generic mapping
  ruleID: struts-action-to-springboot-00003
  when:
    java.referenced:
      location: IMPORT
      pattern: org.apache.struts.action.ActionMapping

- category: mandatory
  customVariables: []
  description: Replace ActionMessages with Spring flash attributes or BindingResult
  effort: 2
  labels:
    - konveyor.io/source=struts
    - konveyor.io/target=springboot
  links:
    - title: Spring Flash Attributes
      url: https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-flash-attributes
  message: |
    Struts `ActionMessages` for success/error messages should be replaced with Spring's `RedirectAttributes` flash attributes.
    
    **Before (Struts):**
    ```java
    ActionMessages messages = new ActionMessages();
    messages.add(ActionMessages.GLOBAL_MESSAGE, 
        new ActionMessage("message.account.saved", account.getAccountNumber()));
    saveMessages(request, messages);
    return mapping.findForward("success");
    ```
    
    **After (Spring MVC):**
    ```java
    @PostMapping("/accounts")
    public String saveAccount(@ModelAttribute AccountDTO account,
                              RedirectAttributes redirectAttributes) {
        accountService.save(account);
        
        // Flash attribute survives redirect
        redirectAttributes.addFlashAttribute("successMessage", 
            "Account " + account.getAccountNumber() + " saved successfully");
        
        return "redirect:/accounts";
    }
    ```
    
    **Display in Thymeleaf template:**
    ```html
    <div th:if="${successMessage}" class="alert alert-success">
        <span th:text="${successMessage}"></span>
    </div>
    ```
    
    For validation errors, use `BindingResult`:
    ```java
    @PostMapping("/accounts")
    public String saveAccount(@Valid @ModelAttribute AccountDTO account,
                              BindingResult result, Model model) {
        if (result.hasErrors()) {
            return "edit"; // Return to form with errors
        }
        // ...
    }
    ```
  ruleID: struts-action-to-springboot-00004
  when:
    java.referenced:
      location: IMPORT
      pattern: org.apache.struts.action.ActionMessages

- category: mandatory
  customVariables: []
  description: Replace ActionErrors with Spring BindingResult
  effort: 3
  labels:
    - konveyor.io/source=struts
    - konveyor.io/target=springboot
  links:
    - title: Spring Validation
      url: https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#validation
  message: |
    Struts `ActionErrors` for validation errors should be replaced with Spring's `BindingResult` and Bean Validation.
    
    **Before (Struts ActionForm):**
    ```java
    public ActionErrors validate(ActionMapping mapping, HttpServletRequest request) {
        ActionErrors errors = new ActionErrors();
        if (holderName == null || holderName.trim().isEmpty()) {
            errors.add("holderName", new ActionMessage("error.holderName.required"));
        }
        return errors;
    }
    ```
    
    **After (Spring Bean Validation):**
    ```java
    // DTO with validation annotations
    public class AccountDTO {
        @NotBlank(message = "Account holder name is required")
        private String holderName;
        
        @NotNull(message = "Account type is required")
        private AccountType accountType;
        
        @Email(message = "Invalid email format")
        private String email;
    }
    
    // Controller with validation
    @PostMapping("/accounts")
    public String saveAccount(@Valid @ModelAttribute("account") AccountDTO account,
                              BindingResult bindingResult, Model model) {
        if (bindingResult.hasErrors()) {
            return "edit"; // Return to form with errors displayed
        }
        accountService.save(account);
        return "redirect:/accounts";
    }
    ```
    
    **Display errors in Thymeleaf:**
    ```html
    <div th:if="${#fields.hasErrors('holderName')}" class="error">
        <span th:errors="*{holderName}"></span>
    </div>
    ```
  ruleID: struts-action-to-springboot-00005
  when:
    java.referenced:
      location: IMPORT
      pattern: org.apache.struts.action.ActionErrors

- category: mandatory
  customVariables: []
  description: Replace ActionMessage with Spring MessageSource
  effort: 2
  labels:
    - konveyor.io/source=struts
    - konveyor.io/target=springboot
  links:
    - title: Spring MessageSource
      url: https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#context-functionality-messagesource
  message: |
    Struts `ActionMessage` for i18n messages should be replaced with Spring's `MessageSource`.
    
    **Before (Struts):**
    ```java
    errors.add("holderName", new ActionMessage("error.holderName.required"));
    messages.add(ActionMessages.GLOBAL_MESSAGE, 
        new ActionMessage("message.account.saved", accountNumber));
    ```
    
    **After (Spring):**
    
    1. Create `messages.properties` in `src/main/resources`:
    ```properties
    error.holderName.required=Account holder name is required
    message.account.saved=Account {0} saved successfully
    ```
    
    2. Use in controller:
    ```java
    @Autowired
    private MessageSource messageSource;
    
    public String saveAccount(..., Locale locale, RedirectAttributes redirectAttributes) {
        String message = messageSource.getMessage("message.account.saved", 
            new Object[]{accountNumber}, locale);
        redirectAttributes.addFlashAttribute("successMessage", message);
        return "redirect:/accounts";
    }
    ```
    
    3. Or use directly in Thymeleaf:
    ```html
    <span th:text="#{error.holderName.required}"></span>
    <span th:text="#{message.account.saved(${account.accountNumber})}"></span>
    ```
  ruleID: struts-action-to-springboot-00006
  when:
    java.referenced:
      location: IMPORT
      pattern: org.apache.struts.action.ActionMessage

